<div class="sidebar">
    <div class="sidebar-wrapper">
        <div class="logo">
            <a href="{{ url_for('index') }}" class="simple-text logo-mini">
                CA
            </a>
            <a href="{{ url_for('index') }}" class="simple-text logo-normal">
                Customer App
            </a>
        </div>

        {# This is the new conditional block. The menu will only appear if a user is logged in. #}
        {% if current_user.is_authenticated %}
        <ul class="nav">

            <!-- Link to Dashboard -->
            <li class="{% if request.path == url_for('index') %} active {% endif %}">
                <a href="{{ url_for('index') }}">
                    <i class="tim-icons icon-chart-pie-36"></i>
                    <p>Dashboard</p>
                </a>
            </li>

            <!-- Link to Add Customer -->
            <li class="{% if request.path == url_for('add_customer_page') %} active {% endif %}">
                <a href="{{ url_for('add_customer_page') }}">
                    <i class="tim-icons icon-simple-add"></i>
                    <p>Add Customer</p>
                </a>
            </li>

                        <!-- Link to Record Payment -->
            <li class="{% if request.path == url_for('record_payment_page') %} active {% endif %}">
                <a href="{{ url_for('record_payment_page') }}">
                    <i class="tim-icons icon-money-coins"></i>
                    <p>Record Payment</p>
                </a>
            </li>

            <!-- === NEW LINK TO VIEW PAYMENTS === -->
            <li class="{% if request.path == url_for('view_payments') %} active {% endif %}">
                <a href="{{ url_for('view_payments') }}">
                    <i class="tim-icons icon-paper"></i>
                    <p>View Payments</p>
                </a>
            </li>
            <!-- ================================= -->

            <!-- Link to View Customers -->
            <li class="{% if request.path == url_for('view_customers') %} active {% endif %}">
                <a href="{{ url_for('view_customers') }}">
                    <i class="tim-icons icon-bullet-list-67"></i>
                    <p>View Customers</p>
                </a>
            </li>

            
            <!-- Link to Segmentation Hub -->
            <li class="{% if request.path == url_for('segmentation') %} active {% endif %}">
                <a href="{{ url_for('segmentation') }}">
                    <i class="tim-icons icon-zoom-split"></i>
                    <p>Segmentation</p>
                </a>
            </li>

            <!-- Link to the NEW Settings Page -->
            <li class="{% if request.path == url_for('settings') %} active {% endif %}">
                <a href="{{ url_for('settings') }}">
                    <i class="tim-icons icon-settings-gear-63"></i>
                    <p>Settings</p>
                </a>
            </li>
            
            <!-- Link to Reports -->
            <li class="{% if 'reports' in request.path %} active {% endif %}">
                <a href="{{ url_for('reports_hub') }}">
                    <i class="tim-icons icon-notes"></i>
                    <p>Reports</p>
                </a>
            </li>
        </ul>
        {% endif %}
        {# End of the conditional block #}
        
    </div>
</div>
